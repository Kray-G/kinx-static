% あなた言語の作り方
% Kray-G, Mr.Diamond Global Blue Publisher
% December 3, 2020

言語処理系を素早く作るプラットフォーム

<param style="JBookA4"/>
<param multibytefont="jp"/>
<param titleSize="48.0"/>
<param subtitleSize="14.4"/>
<param backgroundImage="images/back.jpg"/>

<style-info name="chapter.style" value="BigChapter2"/>

<toc with="lof,lot"/>

# はじめに
## 本書の目的

### 職人気質

さて、プログラミング言語とは全く関係ない話から始まりますがご容赦ください。

ブライアン・メイというギタリストがいます。有名過ぎて説明不要ですが、イギリスのロックバンド Queen のギタリストです。
彼は自宅や知人の家の廃材などを使って自分オリジナルのギター「レッド・スペシャル」を作成したことでも有名です。
このギターは 7 色の音を出せる唯一無二のギターとして知られています。
また、エドワード・ヴァン・ヘイレンというギタリストがいます[^eddie]。
この方も有名過ぎて説明は不要ですが、自らカスタムした「フランケンシュタイン」というギター使っていました。
その道のプロは、自らの道具は自分の手に合うように自分専用に作ってしまうものなのです。

[^eddie]: まことに残念ではありますが 2020 年 10 月 6 日、65 歳の若さで亡くなられました。天才がまた一人...

### プログラマーという人種

現在、プログラマーは何かしらのプログラミング言語を使って仕事をしています。
そのプログラミング言語は「誰か」が「何かの問題を解決するために」作ったものです[^objective]。
プログラミング言語の作り方を解説した本は数多くありますが、
サンプル言語の作成を通して「作り方を学ぶ」「コンパイラの仕組みや実装手法を学ぶ」ということが主眼に置かれています。
したがって、実用的な自分のためのプログラミング言語を作るのはまた別の話であり、
学んだことをベースに自分で 1 から作らなければならないケースが多くありました。

[^objective]: 実は単に作りたかった、というケースも多いのですが。

本書は最終的に「あなたが『あなた言語』を作るためのプラットフォームを作ること」を目的に書きました。
もちろん、サンプル言語作成を通してプログラミング言語の作り方を学べるようになっていますが、
最終的にはそれは実用的なプラットフォームとして機能し、そのまま簡単に「あなた言語」を作れるようにする、
ということが最大の目的となります。

もちろん、何を抽象化するかによって基盤として成り立つかどうかが分かれますが、
概ね一般的なプログラミング言語を作成することは可能とする予定です。

## 軽量 JIT コンパイラ MIR

本書を書こうとしたもう一つの理由が、この MIR[^mir] の存在です。

[^mir]: https://github.com/vnmakarov/mir

MIR は、Ruby の MJIT を改善することが最初の目的として示されていますが、
MIR 自体は Ruby には依存しない JIT 環境として設計・実装されています。
つまり、MIR をバックエンドに使用することによって、
MIR がサポートする様々なプラットフォームで実行可能とすることができます。
本書ではこの MIR をバックエンドに使用する予定です。

これにより、MIR への入力を作り出すフロントエンドを作成するだけで実行可能なプログラミング言語が作成できます。
また、フロントエンドの多くの部分をボイラープレート化して用意することで、
言語処理系を実装するための様々な苦労を低減できるのではと考えています。

# 設計編
## プログラミング言語 KiSS

本書のゴールは「言語処理系を簡単に作ることができる基盤を構築する」です。
そのために以下のサンプル言語作成を通して実際に動作する基盤自体を構築していきます。

* サンプル言語 KiSS
    * KiSS - **Ki**nx **S**ubset with **S**tatically-typed の略です。

ここで、Kinx という名前が出てきましたが、これは私の作成した動的型付けタイプのプログラミング言語[^kinx] です。
これも私自身が使いたい言語、というものを想像したとき、世の中には無く自分の手にフィットするようなプログラミング言語が欲しいという動機から始まりました。
今回実装するプログラミング言語 KiSS は、この Kinx のサブセットと表現しているものの、文法はある程度近づけますが、静的型付けの言語として新規にデザインする予定です。

[^kinx]: https://github.com/Kray-G/kinx

## ミニマム仕様
## 拡張の方針
## 言語処理系の動作概要

# 実装編
## Parser を作る
## Lexer を作る
## AST を作る
## 意味解析を行う
## コード出力
## サンプルプログラムの実行

# 拡張編
## 型の追加

### 文字列のサポート
### 多倍長整数のサポート
### バイナリ配列のサポート
### 配列のサポート
### 連想配列のサポート
### 範囲オブジェクトのサポート

## 高度な機能の追加

### クロージャのサポート
### クラスのサポート
### モジュールのサポート
### ファイバーのサポート

## 制御構造の追加

### for-in
### switch-case

# 「あなた言語」を作ろう
## ボイラープレートの作成
## あなたが作成する部分

### フロントエンド
### AST 拡張
### ライブラリ作成

<appendix/>

# ソースコード
# 謝辞
